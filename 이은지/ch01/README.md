# 1장 자바 기술 시스템 소개
> 내가 작성한 코드는 어떻게 실행되는 것인가?

# JVM

- JVM은 바이트코드를 운영 체제와 하드웨어에 맞는 기계어로 변환하여 실행한다.
- 어떤 물리 머신이든 구동되는 JVM이 있다면 자바 프로그램을 실행할 수 있다.
- 자바 외에도 JVM 위에서 동작하는 프로그래밍 언어는 코틀린, 클로저, JRuby, 그루비 등으로 다양하다.

# JIT 컴파일러

- JIT는 Just-In-Time, 말 그대로 사용되는 그 때 컴파일 한다는 의미다.
- JVM의 JIT 컴파일 단위는 메서드다.
- JVM은 어떤 메서드를 실행 할 때, 최초에는 인터프리터로 실행한다.
- 자주 호출되는 메서드를 핫코드으로 보고, JIT 컴파일 해서 네이티브 코드로 만들어 실행 속도를 향상시킨다.
- 그래서 이름이 hotspot JVM이다.
- JIT 컴파일러는 핫코드를 기계어로 변환할 때 다양한 최적화 기법을 적용한다.
    - 자주 호출되는 작은 메서드를 인라이닝하여 호출 비용을 줄이거나, 반복문을 최적하여 프로그램의 성능을 향상시킨다.
- JVM은 Tiered 컴파일 방식을 사용해 클라이언트 컴파일러와 서버 컴파일러를 조합하여 최적화한다.
    - JVM은 2가지 JIT compiler를 가지고 있다.
        - C1 compile(Client Compiler)
            - 빠른 컴파일러
        - C2 compile(Server Compiler)
            - C1 보다 느리지만 더 높은 수준으로 최적화하는 컴파일러
    - JIT compile을 프로파일링 수준에 따라 C1, C2 두 단계에 걸쳐 진행한다.(그래서 Tiered Compilation)
    - 코드는 먼저 클라이언트 컴파일러로 컴파일 되고 많이 쓰이게 되면 역최적화 후 서버 컴파일러로 재컴파일 된다.
    - Tiered Compilation은 기본적으로 활성화 되어 있다.
    - Tiered Compilation은 자바 7부터 릴리즈 되었으며 자바 8에서는 기본으로 사용할 수 있다.

# 그랄 VM과 그랄 컴파일러

- 2018년 4월 등장. 폴리글랏 VM.
- 핫스팟 가상 머신 위에 구축된 크로스 언어 풀 스택 가상머신이다.
- 자바, 코틀린, 스칼라, 그루비 같은 자바 가상 머신 언어들은 물론 LLVM 기반 컴파일러를 사용하는 C/C++, 러스트 같은 언어들, 그 외 자바스크립트, 루비, 파이썬, R, 웹 어셈블리까지도 지원한다.
- 그랄VM은 기본적으로 각종 언어의 소스 코드나 컴파일된 중간 형식을 인터프리터를 통해 그랄 VM이 이해할 수 있는 중간 언어로 변환하는 식으로 작동한다.

# AOT 컴파일러

- 애플리케이션을 실행하기 전에 소스 코드나 바이트 코드를 네이티브 코드로 미리 컴파일하는 컴파일러이다.
    - 애플리케이션 실행 중에 추가적인 컴파일 작업이 필요 없도록 만들어, 빠른 실행 속도를 제공한다.
- 사전(ahead of time)이란 의미의 AOT는 적시(just in time)의 상대적인 개념이다.
- 단점으로는 하드웨어와 운영 체제별로 따로 컴파일해 배포해야 한다.
    - 또한 자바의 동적 링크 특성이 크게 줄어든다. 컴파일할 코드에 대한 모든 것을 컴파일타임에 알 수 있어야 한다.

# 서브스트레이트 VM

- 그랄VM의 일부로, 자바 애플리케이션을 네이티브 이미지로 컴파일할 때 사용되는 경량 가상 머신이다.
- 사전 컴파일된 네이티브 코드를 핫스팟 가상 머신 없이 실행하는 기술로 매우 적은 메모리 사용량과 빠른 시작 속도를 보장한다.
- 그랄 VM은 서브스트레이트 VM과 사용자 프로그램을 하나로 묶어 네이티브 이미지를 생성한다.
- 주의할 점은 컴파일러가 찾을 수 없는 코드나 클래스 라이브러리를 동적으로 읽어 들일 수 없다는 점이다.

# 참고

- https://d2.naver.com/helloworld/1230
- https://umbum.dev/279/
- https://umbum.dev/2033/
- [https://velog.io/@youngerjesus/자바-JIT-컴파일러](https://velog.io/@youngerjesus/%EC%9E%90%EB%B0%94-JIT-%EC%BB%B4%ED%8C%8C%EC%9D%BC%EB%9F%AC)
- https://github.com/whiteship/live-study/issues/1
 
